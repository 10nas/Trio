var freeaps;freeaps=(()=>{var e={241:(e,r,i)=>{var o=i(533);e.exports=function(e,r,i){return i.useCustomPeakTime||(r.dia=i.dia,r.insulinPeakTime=i.insulinPeakTime),r.curve=i.curve,inputs={preppedGlucose:e,previousAutotune:r,pumpProfile:i},o(inputs)}},533:(e,r,i)=>{var o=i(263);e.exports=function(e){var r=e.previousAutotune,i=e.pumpProfile,a=i.basalprofile,t=r.basalprofile,n=r.isfProfile,s=n.sensitivities[0].sensitivity,u=r.carb_ratio,l=s/u,d=r.dia,v=r.insulinPeakTime;if(!0==!r.useCustomPeakTime&&(v="ultra-rapid"===r.curve?55:75),i)var f=i.isfProfile;if(f&&f.sensitivities[0])var m=f.sensitivities[0].sensitivity,h=i.carb_ratio,p=m/h;u||(u=h),l||(l=p),s||(s=m);var c=e.preppedGlucose,F=c.CSFGlucoseData,C=c.ISFGlucoseData,g=c.basalGlucoseData,R=c.CRData,S=c.diaDeviations,M=c.peakDeviations,D=d;if(S){for(var I=S[2].meanDeviation,b=S[2].RMSDeviation,x=1e6,w=1e6,T=2,P=2,k=0;k<S.length;k++){var L=S[k].meanDeviation,B=S[k].RMSDeviation;L<x&&(x=Math.round(1e3*L)/1e3,T=k),B<w&&(w=Math.round(1e3*B)/1e3,P=k)}console.error("Best insulinEndTime for meanDeviations:",S[T].dia,"hours"),console.error("Best insulinEndTime for RMSDeviations:",S[P].dia,"hours"),T<2&&P<2?S[1].meanDeviation<.99*I&&S[1].RMSDeviation<.99*b&&(D=S[1].dia):T>2&&P>2&&S[3].meanDeviation<.99*I&&S[3].RMSDeviation<.99*b&&(D=S[3].dia),D>12&&(console.error("insulinEndTime maximum is 12h: not raising further"),D=12),D!==d?console.error("Adjusting insulinEndTime from",d,"to",D,"hours"):console.error("Leaving insulinEndTime unchanged at",d,"hours")}var O=v;if(M&&M[2]){var _=M[2].meanDeviation,y=M[2].RMSDeviation;for(x=1e6,w=1e6,T=2,P=2,k=0;k<M.length;k++)L=M[k].meanDeviation,B=M[k].RMSDeviation,L<x&&(x=Math.round(1e3*L)/1e3,T=k),B<w&&(w=Math.round(1e3*B)/1e3,P=k);console.error("Best insulinPeakTime for meanDeviations:",M[T].peak,"minutes"),console.error("Best insulinPeakTime for RMSDeviations:",M[P].peak,"minutes"),T<2&&P<2?M[1].meanDeviation<.99*_&&M[1].RMSDeviation<.99*y&&(O=M[1].peak):T>2&&P>2&&M[3].meanDeviation<.99*_&&M[3].RMSDeviation<.99*y&&(O=M[3].peak),O!==v?console.error("Adjusting insulinPeakTime from",v,"to",O,"minutes"):console.error("Leaving insulinPeakTime unchanged at",v)}var E=0,N=0;R.forEach((function(e){var r=(e.CREndBG-e.CRInitialBG)/s;e.CREndIOB,e.CRInitialIOB;e.CRInsulinTotal=e.CRInitialIOB+e.CRInsulin+r;Math.round(e.CRCarbs/e.CRInsulinTotal*1e3);e.CRInsulinTotal>0&&(E+=e.CRCarbs,N+=e.CRInsulinTotal)})),N=Math.round(1e3*N)/1e3;var G=Math.round(E/N*1e3)/1e3;console.error("CRTotalCarbs:",E,"CRTotalInsulin:",N,"totalCR:",G);var j=[],A=[];for(k=0;k<24;k++){for(var J=0;J<t.length;++J)if(t[J].minutes<=60*k){if(0===t[J].rate)return void console.error("ERROR: bad basalProfile",t[J]);j[k]=JSON.parse(JSON.stringify(t[J]))}j[k].i=k,j[k].minutes=60*k;var H=("000"+k).slice(-2);if(j[k].start=H+":00:00",j[k].rate=Math.round(1e3*j[k].rate)/1e3,a&&a[0]){for(J=0;J<a.length;++J){if(0===a[J].rate)return void console.error("ERROR: bad pumpBasalProfile",a[J]);a[J].minutes<=60*k&&(A[k]=JSON.parse(JSON.stringify(a[J])))}A[k].i=k,A[k].minutes=60*k,A[k].rate=Math.round(1e3*A[k].rate)/1e3}}for(var U=JSON.parse(JSON.stringify(j)),q=0;q<24;q++){var z=0;for(k=0;k<g.length;++k){var K;g[k].date?K=new Date(g[k].date):g[k].displayTime?K=new Date(g[k].displayTime.replace("T"," ")):g[k].dateString?K=new Date(g[k].dateString):console.error("Could not determine last BG time"),q===K.getHours()&&(z+=parseFloat(g[k].deviation))}z=Math.round(1e3*z)/1e3,console.error("Hour",q.toString(),"total deviations:",z,"mg/dL");var Q=.2*z/s;if(Q=Math.round(100*Q)/100,console.error("Hour",q,"basal adjustment needed:",Q,"U/hr"),Q>0)for(var V=-3;V<0;V++){var W=q+V;W<0&&(W+=24),U[W].rate+=Q/3,U[W].rate=Math.round(1e3*U[W].rate)/1e3}else if(Q<0){var X=0;for(V=-3;V<0;V++)(W=q+V)<0&&(W+=24),X+=U[W].rate;var Y=1+Q/X;for(V=-3;V<0;V++)(W=q+V)<0&&(W+=24),U[W].rate=U[W].rate*Y,U[W].rate=Math.round(1e3*U[W].rate)/1e3}}if(a&&a[0])for(q=0;q<24;q++){if(void 0!==i.autosens_max)var Z=i.autosens_max;else Z=1.2;if(void 0!==i.autosens_min)var $=i.autosens_min;else $=.7;var ee=A[q].rate*Z,re=A[q].rate*$;U[q].rate>ee?(console.error("Limiting hour",q,"basal to",ee.toFixed(2),"(which is",Z,"* pump basal of",A[q].rate,")"),U[q].rate=ee):U[q].rate<re&&(console.error("Limiting hour",q,"basal to",re.toFixed(2),"(which is",$,"* pump basal of",A[q].rate,")"),U[q].rate=re),U[q].rate=Math.round(1e3*U[q].rate)/1e3}var ie=0;for(q=0;q<24;q++)if(j[q].rate===U[q].rate){for(var oe=23,ae=q;ae<24;ae++)if(j[ae].rate!==U[ae].rate){oe=ae;break}U[q].rate=Math.round(1e3*(.8*j[q].rate+.1*U[ie].rate+.1*U[oe].rate))/1e3,U[q].untuned?U[q].untuned++:U[q].untuned=1,console.error("Adjusting hour",q,"basal from",j[q].rate,"to",U[q].rate,"based on hour",ie,"=",U[ie].rate,"and hour",oe,"=",U[oe].rate)}else ie=q;console.error(U),t=U,z=0;var te,ne=0,se=0,ue=0;for(k=0;k<F.length;++k)if("start"===F[k].mealAbsorption)z=0,ne=parseInt(F[k].mealCarbs);else if("end"===F[k].mealAbsorption){se+=ne,ue+=z+=parseFloat(F[k].deviation)}else z+=Math.max(0*r.min_5m_carbimpact,parseFloat(F[k].deviation)),ne=Math.max(ne,parseInt(F[k].mealCarbs));0===se&&(se+=ne),0===ue&&(ue+=z);var le=.8*l+.2*(te=0===se?l:Math.round(ue/se*100)/100);if(void 0!==p){var de=p*Z,ve=p*$;le>de?(console.error("Limiting CSF to",de.toFixed(2),"(which is",Z,"* pump CSF of",p,")"),le=de):le<ve&&(console.error("Limiting CSF to",ve.toFixed(2),"(which is",$,"* pump CSF of",p,")"),le=ve)}var fe=Math.round(1e3*l)/1e3;if(le=Math.round(1e3*le)/1e3,ue=Math.round(1e3*ue)/1e3,console.error("totalMealCarbs:",se,"totalDeviations:",ue,"oldCSF",fe,"fullNewCSF:",te,"newCSF:",le),le&&(l=le),0===G)var me=u;else me=G;var he=h*Z;he>150&&(he=150);var pe=h*$;pe<3&&(pe=3),void 0!==h&&(me>he?(console.error("Limiting fullNewCR from",me,"to",he.toFixed(2),"(which is",Z,"* pump CR of",h,")"),me=he):me<pe&&(console.error("Limiting fullNewCR from",me,"to",pe.toFixed(2),"(which is",$,"* pump CR of",h,")"),me=pe));var ce=.8*u+.2*me;void 0!==h&&(ce>he?(console.error("Limiting CR to",he.toFixed(2),"(which is",Z,"* pump CR of",h,")"),ce=he):ce<pe&&(console.error("Limiting CR to",pe.toFixed(2),"(which is",$,"* pump CR of",h,")"),ce=pe)),ce=Math.round(1e3*ce)/1e3,console.error("oldCR:",u,"fullNewCR:",me,"newCR:",ce),ce&&(u=ce),z=[];var Fe=[],Ce=[],ge=[];for(k=0;k<C.length;++k){deviation=parseFloat(C[k].deviation),z.push(deviation);var Re=parseFloat(C[k].BGI);Fe.push(Re);var Se=parseFloat(C[k].avgDelta);Ce.push(Se);var Me=1+deviation/Re;ge.push(Me)}Ce.sort((function(e,r){return e-r})),Fe.sort((function(e,r){return e-r})),z.sort((function(e,r){return e-r})),ge.sort((function(e,r){return e-r}));var De,Ie=o(z,.5),be=o(Fe,.5),xe=Math.round(1e3*o(ge,.5))/1e3,we=s;C.length<10?console.error("Only found",C.length,"ISF data points, leaving ISF unchanged at",s):we=s*xe,we=Math.round(1e3*we)/1e3,De=void 0!==i.autotune_isf_adjustmentFraction?i.autotune_isf_adjustmentFraction:1;var Te=m/$,Pe=m/Z;if(void 0!==m){if(we<0)var ke=s;else ke=De*we+(1-De)*m;ke>Te?(console.error("Limiting adjusted ISF of",ke.toFixed(2),"to",Te.toFixed(2),"(which is pump ISF of",m,"/",$,")"),ke=Te):ke<Pe&&(console.error("Limiting adjusted ISF of",ke.toFixed(2),"to",Pe.toFixed(2),"(which is pump ISF of",m,"/",Z,")"),ke=Pe);var Le=.8*s+.2*ke;Le>Te?(console.error("Limiting ISF of",Le.toFixed(2),"to",Te.toFixed(2),"(which is pump ISF of",m,"/",$,")"),Le=Te):Le<Pe&&(console.error("Limiting ISF of",Le.toFixed(2),"to",Pe.toFixed(2),"(which is pump ISF of",m,"/",Z,")"),Le=Pe)}Le=Math.round(1e3*Le)/1e3,Ie=Math.round(1e3*Ie)/1e3,be=Math.round(1e3*be)/1e3,ke=Math.round(1e3*ke)/1e3,console.error("p50deviation:",Ie,"p50BGI",be,"p50ratios:",xe,"Old ISF:",s,"fullNewISF:",we,"adjustedISF:",ke,"newISF:",Le,"newDIA:",D,"newPeak:",O),Le&&(s=Le);var Be=r;return Be.basalprofile=t,n.sensitivities[0].sensitivity=s,Be.isfProfile=n,Be.sens=s,Be.csf=l,u=Math.round(1e3*u)/1e3,Be.carb_ratio=u,Be.dia=D,Be.insulinPeakTime=O,(S||M)&&(Be.useCustomPeakTime=!0),Be}},263:e=>{e.exports=function(e,r){if(0===e.length)return 0;if("number"!=typeof r)throw new TypeError("p must be a number");if(r<=0)return e[0];if(r>=1)return e[e.length-1];var i=e.length*r,o=Math.floor(i),a=o+1,t=i%1;return a>=e.length?e[o]:e[o]*(1-t)+e[a]*t}}},r={};return function i(o){if(r[o])return r[o].exports;var a=r[o]={exports:{}};return e[o](a,a.exports,i),a.exports}(241)})();